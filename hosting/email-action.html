<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Verify your email – M Auction</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 24px; min-height: 100vh; display: flex; align-items: center; justify-content: center; background: #f5f5f5; }
    .card { background: #fff; border-radius: 12px; padding: 32px; max-width: 420px; width: 100%; box-shadow: 0 2px 12px rgba(0,0,0,0.08); }
    h1 { font-size: 1.35rem; margin: 0 0 12px; color: #1a1a1a; }
    p { margin: 0 0 24px; color: #555; font-size: 0.95rem; line-height: 1.5; }
    .btn { display: inline-block; background: #006AA6; color: #fff; border: none; padding: 14px 24px; font-size: 1rem; font-weight: 600; border-radius: 8px; cursor: pointer; width: 100%; }
    .btn:hover { background: #005a94; }
    .btn:disabled { opacity: 0.6; cursor: not-allowed; }
    .success { color: #0a7b0a; margin-bottom: 16px; }
    .error { color: #c00; margin-bottom: 16px; font-size: 0.9rem; }
    .back { margin-top: 20px; font-size: 0.9rem; }
    .back a { color: #006AA6; text-decoration: none; }
    .back a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <div class="card">
    <div id="prompt">
      <h1>Verify your email</h1>
      <p>Click the button below to confirm your email address. This link will only work once.</p>
      <button type="button" class="btn" id="verifyBtn">Confirm my email</button>
    </div>
    <div id="success" style="display: none;">
      <h1>Email verified</h1>
      <p class="success">Your email has been verified. You can close this page and return to the M Auction app.</p>
      <div class="back" id="continueWrap" style="display: none;"><a href="#" id="continueLink">Return to app</a></div>
    </div>
    <div id="error" style="display: none;">
      <h1>Link invalid or used</h1>
      <p class="error" id="errorText"></p>
      <p>If the link expired or was already used, open the M Auction app and tap &quot;Send new link&quot; to get a fresh verification email.</p>
    </div>
  </div>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script>
    function getParam(name) {
      var params = new URLSearchParams(window.location.search);
      return params.get(name) || '';
    }
    var mode = getParam('mode');
    var actionCode = getParam('oobCode');
    var apiKey = getParam('apiKey');
    var continueUrl = getParam('continueUrl');

    var promptEl = document.getElementById('prompt');
    var successEl = document.getElementById('success');
    var errorEl = document.getElementById('error');
    var verifyBtn = document.getElementById('verifyBtn');
    var errorText = document.getElementById('errorText');
    var continueWrap = document.getElementById('continueWrap');
    var continueLink = document.getElementById('continueLink');

    var validModes = ['verifyEmail', 'verifyAndChangeEmail'];
    if (validModes.indexOf(mode) === -1 || !actionCode || !apiKey) {
      promptEl.style.display = 'none';
      errorEl.style.display = 'block';
      errorText.textContent = 'This link is missing required parameters. Please request a new verification link in the app.';
    } else {
      verifyBtn.addEventListener('click', function() {
        verifyBtn.disabled = true;
        verifyBtn.textContent = 'Verifying…';
        var app = firebase.initializeApp({ apiKey: apiKey });
        app.auth().applyActionCode(actionCode).then(function() {
          promptEl.style.display = 'none';
          successEl.style.display = 'block';
          if (continueUrl) {
            continueWrap.style.display = 'block';
            continueLink.href = continueUrl;
          }
        }).catch(function(err) {
          promptEl.style.display = 'none';
          errorEl.style.display = 'block';
          errorText.textContent = err.message || 'This link has expired or was already used. Please request a new link in the app.';
        }).finally(function() {
          verifyBtn.disabled = false;
          verifyBtn.textContent = 'Confirm my email';
        });
      });
    }
  </script>
</body>
</html>
